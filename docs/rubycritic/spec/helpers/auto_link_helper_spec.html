<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../overview.html"><img src="../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2017-07-29 14:48:31 +0100'>2017-07-29 14:48:31 +0100</time>
        
      </span>
    </div>
    <div>
      <h3><small>spec/helpers /</small> auto_link_helper_spec.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">361</span><small> lines of codes</small></div>
              <div><span class="metric">0</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">N/A</span><small> complexity/method</small></div>
              <div><span class="metric">1</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">727.06</span><small> complexity</small></div>
              <div><span class="metric">147</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                4
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;rails_helper&#39;

RSpec.describe AutoLinkHelper, type: :helper do
  describe &quot;#auto_link&quot; do
    it &quot;auto links urls embedded in a text block&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(#auto_link)::it#auto links urls embedded in a text block has a flog score of 415</span>          </div>  </li></ol>
      email_raw    = &quot;david@loudthinking.com&quot;
      email_result = &quot;&lt;a href=\&quot;mailto:#{email_raw}\&quot;&gt;#{email_raw}&lt;/a&gt;&quot;
      link_raw     = &quot;http://www.rubyonrails.com&quot;
      link_result  = &quot;&lt;a href=\&quot;#{link_raw}\&quot;&gt;#{link_raw}&lt;/a&gt;&quot;
      link_result_with_options = %{&lt;a target=&quot;_blank&quot; href=&quot;#{link_raw}&quot;&gt;#{link_raw}&lt;/a&gt;}

      expect(helper.auto_link(nil)).to eq(&quot;&quot;)
      expect(helper.auto_link(&quot;&quot;)).to eq(&quot;&quot;)
      expect(helper.auto_link(&quot;#{link_raw} #{link_raw} #{link_raw}&quot;)).to eq(&quot;#{link_result} #{link_result} #{link_result}&quot;)
      expect(helper.auto_link(&quot;hello #{email_raw}&quot;, link: :email_addresses)).to eq(&quot;hello #{email_result}&quot;)
      expect(helper.auto_link(&quot;Go to #{link_raw}&quot;, link: :urls)).to eq(&quot;Go to #{link_result}&quot;)
      expect(helper.auto_link(&quot;Go to #{link_raw}&quot;, link: :email_addresses)).to eq(&quot;Go to #{link_raw}&quot;)
      expect(helper.auto_link(&quot;Go to #{link_raw} and say hello to #{email_raw}&quot;)).to eq(&quot;Go to #{link_result} and say hello to #{email_result}&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L18" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L24" class="js-smell-location">1</a>                  </div>  </li></ol>
      expect(helper.auto_link(&quot;&lt;p&gt;Link #{link_raw}&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Link #{link_result}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;#{link_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link_result} Link&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Link #{link_raw}&lt;/p&gt;&quot;, link: :all, html: { target: &quot;_blank&quot; })).to eq(&quot;&lt;p&gt;Link #{link_result_with_options}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;Go to #{link_raw}.&quot;)).to eq(&quot;Go to #{link_result}.&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Go to #{link_raw}, then say hello to #{email_raw}.&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Go to #{link_result}, then say hello to #{email_result}.&lt;/p&gt;&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L23" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L39" class="js-smell-location">1</a>                  </div>  </li></ol>
      expect(helper.auto_link(&quot;#{link_result} #{link_raw}&quot;)).to eq(&quot;#{link_result} #{link_result}&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L18" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L24" class="js-smell-location">1</a>                  </div>  </li></ol>

      email2_raw    = &quot;+david@loudthinking.com&quot;
      email2_result = &quot;&lt;a href=\&quot;mailto:%2Bdavid@loudthinking.com\&quot;&gt;+david@loudthinking.com&lt;/a&gt;&quot;
      expect(helper.auto_link(email2_raw)).to eq(email2_result)
      expect(helper.auto_link(email2_raw, link: :all)).to eq(email2_result)
      expect(helper.auto_link(email2_raw, link: :email_addresses)).to eq(email2_result)

      link2_raw    = &quot;www.rubyonrails.com&quot;
      link2_result = &quot;&lt;a href=\&quot;http://www.rubyonrails.com\&quot;&gt;www.rubyonrails.com&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;Go to #{link2_raw}&quot;, link: :urls)).to eq(&quot;Go to #{link2_result}&quot;)
      expect(helper.auto_link(&quot;Go to #{link2_raw}&quot;, link: :email_addresses)).to eq(&quot;Go to #{link2_raw}&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Go to #{link2_raw}&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Go to #{link2_result}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;#{link2_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link2_result} Link&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;Go to #{link2_raw}.&quot;)).to eq(&quot;Go to #{link2_result}.&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Say hello to #{email_raw}, then go to #{link2_raw}.&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Say hello to #{email_result}, then go to #{link2_result}.&lt;/p&gt;&quot;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L23" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L39" class="js-smell-location">1</a>                  </div>  </li></ol>

      link3_raw    = &#39;http://manuals.ruby-on-rails.com/read/chapter.need_a-period/103#page281&#39;
      link3_result = &quot;&lt;a href=\&quot;http://manuals.ruby-on-rails.com/read/chapter.need_a-period/103#page281\&quot;&gt;http://manuals.ruby-on-rails.com/read/chapter.need_a-period/103#page281&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;Go to #{link3_raw}&quot;, link: :urls)).to eq(&quot;Go to #{link3_result}&quot;)
      expect(helper.auto_link(&quot;Go to #{link3_raw}&quot;, link: :email_addresses)).to eq(&quot;Go to #{link3_raw}&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Go to #{link3_raw}&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Go to #{link3_result}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;#{link3_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link3_result} Link&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;Go to #{link3_raw}.&quot;)).to eq(&quot;Go to #{link3_result}.&quot;)
      expect(helper.auto_link(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L48" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L78" class="js-smell-location">1</a>                  <a href="auto_link_helper_spec.html#L91" class="js-smell-location">2</a>                  </div>  </li></ol>
        &quot;&lt;p&gt;Go to #{link3_raw}. Seriously, #{link3_raw}? I think I&#39;ll say hello to #{email_raw}. Instead.&lt;/p&gt;&quot;
      )).to eq(
        &quot;&lt;p&gt;Go to #{link3_result}. Seriously, #{link3_result}? I think I&#39;ll say hello to #{email_result}. Instead.&lt;/p&gt;&quot;
      )

      link4_raw    = &quot;http://foo.example.com/controller/action?parm=value&amp;p2=v2#anchor123&quot;
      link4_result = &quot;&lt;a href=\&quot;http://foo.example.com/controller/action?parm=value&amp;amp;p2=v2#anchor123\&quot;&gt;http://foo.example.com/controller/action?parm=value&amp;amp;p2=v2#anchor123&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;&lt;p&gt;Link #{link4_raw}&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Link #{link4_result}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;#{link4_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link4_result} Link&lt;/p&gt;&quot;)

      link5_raw    = &quot;http://foo.example.com:3000/controller/action&quot;
      link5_result = &quot;&lt;a href=\&quot;#{link5_raw}\&quot;&gt;#{link5_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;&lt;p&gt;#{link5_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link5_result} Link&lt;/p&gt;&quot;)

      link6_raw    = &quot;http://foo.example.com:3000/controller/action+pack&quot;
      link6_result = &quot;&lt;a href=\&quot;#{link6_raw}\&quot;&gt;#{link6_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;&lt;p&gt;#{link6_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link6_result} Link&lt;/p&gt;&quot;)

      link7_raw    = &quot;http://foo.example.com/controller/action?parm=value&amp;p2=v2#anchor-123&quot;
      link7_result = &quot;&lt;a href=\&quot;http://foo.example.com/controller/action?parm=value&amp;amp;p2=v2#anchor-123\&quot;&gt;http://foo.example.com/controller/action?parm=value&amp;amp;p2=v2#anchor-123&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;&lt;p&gt;#{link7_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link7_result} Link&lt;/p&gt;&quot;)

      link8_raw    = &quot;http://foo.example.com:3000/controller/action.html&quot;
      link8_result = &quot;&lt;a href=\&quot;#{link8_raw}\&quot;&gt;#{link8_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;Go to #{link8_raw}&quot;, link: :urls)).to eq(&quot;Go to #{link8_result}&quot;)
      expect(helper.auto_link(&quot;Go to #{link8_raw}&quot;, link: :email_addresses)).to eq(&quot;Go to #{link8_raw}&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Go to #{link8_raw}&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Go to #{link8_result}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;#{link8_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link8_result} Link&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;Go to #{link8_raw}.&quot;)).to eq(&quot;Go to #{link8_result}.&quot;)
      expect(helper.auto_link(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L48" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L78" class="js-smell-location">1</a>                  <a href="auto_link_helper_spec.html#L91" class="js-smell-location">2</a>                  </div>  </li></ol>
        &quot;&lt;p&gt;Go to #{link8_raw}. Seriously, #{link8_raw}? I think I&#39;ll say hello to #{email_raw}. Instead.&lt;/p&gt;&quot;
      )).to eq(
        &quot;&lt;p&gt;Go to #{link8_result}. Seriously, #{link8_result}? I think I&#39;ll say hello to #{email_result}. Instead.&lt;/p&gt;&quot;
      )

      link9_raw    = &quot;http://business.timesonline.co.uk/article/0,,9065-2473189,00.html&quot;
      link9_result = &quot;&lt;a href=\&quot;#{link9_raw}\&quot;&gt;#{link9_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;Go to #{link9_raw}&quot;, link: :urls)).to eq(&quot;Go to #{link9_result}&quot;)
      expect(helper.auto_link(&quot;Go to #{link9_raw}&quot;, link: :email_addresses)).to eq(&quot;Go to #{link9_raw}&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;Go to #{link9_raw}&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;Go to #{link9_result}&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;&lt;p&gt;#{link9_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link9_result} Link&lt;/p&gt;&quot;)
      expect(helper.auto_link(&quot;Go to #{link9_raw}.&quot;)).to eq(&quot;Go to #{link9_result}.&quot;)
      expect(helper.auto_link(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="auto_link_helper_spec.html#L48" class="js-smell-location">0</a>                  <a href="auto_link_helper_spec.html#L78" class="js-smell-location">1</a>                  <a href="auto_link_helper_spec.html#L91" class="js-smell-location">2</a>                  </div>  </li></ol>
        &quot;&lt;p&gt;Go to #{link9_raw}. Seriously, #{link9_raw}? I think I&#39;ll say hello to #{email_raw}. Instead.&lt;/p&gt;&quot;
      )).to eq(
        &quot;&lt;p&gt;Go to #{link9_result}. Seriously, #{link9_result}? I think I&#39;ll say hello to #{email_result}. Instead.&lt;/p&gt;&quot;
      )

      link10_raw    = &quot;http://www.mail-archive.com/ruby-talk@ruby-lang.org/&quot;
      link10_result = &quot;&lt;a href=\&quot;#{link10_raw}\&quot;&gt;#{link10_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;&lt;p&gt;#{link10_raw} Link&lt;/p&gt;&quot;)).to eq(&quot;&lt;p&gt;#{link10_result} Link&lt;/p&gt;&quot;)

      link11_raw    = &quot;http://asakusa.rubyist.net/&quot;
      link11_result = &quot;&lt;a href=\&quot;#{link11_raw}\&quot;&gt;#{link11_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(&quot;浅草.rbの公式サイトはこちら#{link11_raw}&quot;)).to eq(&quot;浅草.rbの公式サイトはこちら#{link11_result}&quot;)

      link12_raw    = &quot;http://tools.ietf.org/html/rfc3986&quot;
      link12_result = &quot;&lt;a href=\&quot;#{link12_raw}\&quot;&gt;#{link12_raw}&lt;/a&gt;&quot;
      expect(helper.auto_link(
        &quot;&lt;p&gt;#{link12_raw} text-after-nonbreaking-space&lt;/p&gt;&quot;
      )).to eq(
        &quot;&lt;p&gt;#{link12_result} text-after-nonbreaking-space&lt;/p&gt;&quot;
      )

      link13_raw    = &quot;HTtP://www.rubyonrails.com&quot;
      expect(helper.auto_link(link13_raw)).to eq(&quot;&lt;a href=\&quot;#{link13_raw}\&quot;&gt;#{link13_raw}&lt;/a&gt;&quot;)
    end

    it &quot;doesn&#39;t auto link urls inside tag attributes&quot; do
      text = &quot;&lt;img src=\&quot;http://www.rubyonrails.org/images/rails.png\&quot;&gt;&quot;
      result = &quot;&lt;img src=\&quot;http://www.rubyonrails.org/images/rails.png\&quot;&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;auto links urls with parentheses&quot; do
      text = &quot;(link: http://en.wikipedia.org/wiki/Sprite_(computer_graphics))&quot;
      result = &quot;(link: &lt;a href=\&quot;http://en.wikipedia.org/wiki/Sprite_(computer_graphics)\&quot;&gt;http://en.wikipedia.org/wiki/Sprite_(computer_graphics)&lt;/a&gt;)&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;auto links urls with brackets&quot; do
      text = &quot;[link: http://en.wikipedia.org/wiki/Sprite_[computer_graphics]]&quot;
      result = &quot;[link: &lt;a href=\&quot;http://en.wikipedia.org/wiki/Sprite_[computer_graphics]\&quot;&gt;http://en.wikipedia.org/wiki/Sprite_[computer_graphics]&lt;/a&gt;]&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;auto links urls with braces&quot; do
      text = &quot;{link: http://en.wikipedia.org/wiki/Sprite_{computer_graphics}}&quot;
      result = &quot;{link: &lt;a href=\&quot;http://en.wikipedia.org/wiki/Sprite_{computer_graphics}\&quot;&gt;http://en.wikipedia.org/wiki/Sprite_{computer_graphics}&lt;/a&gt;}&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;accepts options&quot; do
      text = &quot;Welcome to my new blog at http://www.myblog.com/. Please e-mail me at me@email.com.&quot;
      options = { link: :all, html: { class: &quot;menu&quot;, target: &quot;_blank&quot; } }
      result = &quot;Welcome to my new blog at &lt;a class=\&quot;menu\&quot; target=\&quot;_blank\&quot; href=\&quot;http://www.myblog.com/\&quot;&gt;http://www.myblog.com/&lt;/a&gt;. Please e-mail me at &lt;a class=\&quot;menu\&quot; target=\&quot;_blank\&quot; href=\&quot;mailto:me@email.com\&quot;&gt;me@email.com&lt;/a&gt;.&quot;

      expect(helper.auto_link(text, options)).to eq(result)
    end

    it &quot;handles multiple trailing punctuations&quot; do
      text = &quot;(link: http://youtube.com).&quot;
      result = &quot;(link: &lt;a href=\&quot;http://youtube.com\&quot;&gt;http://youtube.com&lt;/a&gt;).&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;accepts a block&quot; do
      text = &quot;&lt;p&gt;http://api.rubyonrails.com/Foo.html&lt;br&gt;fantabulous@shiznadel.ic&lt;br&gt;&lt;/p&gt;&quot;
      result = &quot;&lt;p&gt;&lt;a href=\&quot;http://api.rubyonrails.com/Foo.html\&quot;&gt;http://...&lt;/a&gt;&lt;br&gt;&lt;a href=\&quot;mailto:fantabulous@shiznadel.ic\&quot;&gt;fantabu...&lt;/a&gt;&lt;br&gt;&lt;/p&gt;&quot;

      expect(helper.auto_link(text) { |u| truncate(u, length: 10) }).to eq(result)
    end

    it &quot;accepts a block that returns HTML&quot; do
      text = &quot;My pic: http://example.com/pic.png -- full album here http://example.com/album?a&amp;amp;b=c&quot;
      result = &quot;My pic: &lt;a href=\&quot;http://example.com/pic.png\&quot;&gt;&lt;img src=\&quot;http://example.com/pic.png\&quot; width=\&quot;160px\&quot;&gt;&lt;/a&gt; -- full album here &lt;a href=\&quot;http://example.com/album?a&amp;amp;b=c\&quot;&gt;http://example.com/album?a&amp;amp;b=c&lt;/a&gt;&quot;

      block = lambda do |link|
        if link =~ /\.(jpg|gif|png|bmp|tif)$/i
          raw &quot;&lt;img src=\&quot;#{link}\&quot; width=\&quot;160px\&quot;&gt;&quot;
        else
          link
        end
      end

      expect(helper.auto_link(text, &amp;block)).to eq(result)
    end

    it &quot;sanitizes input when sanitize option is not false&quot; do
      text = &quot;http://www.rubyonrails.com?id=1&amp;num=2&lt;script&gt;alert(&#39;malicious!&#39;)&lt;/script&gt;&quot;
      result = &quot;&lt;a href=\&quot;http://www.rubyonrails.com?id=1&amp;amp;num=2alert(&#39;malicious!&#39;)\&quot;&gt;http://www.rubyonrails.com?id=1&amp;amp;num=2alert(&#39;malicious!&#39;)&lt;/a&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
      expect(helper.auto_link(text)).to be_html_safe
    end

    it &quot;sanitizes input with the sanitize_options&quot; do
      text = &quot;http://www.rubyonrails.com?id=1&amp;num=2&lt;script&gt;alert(&#39;malicious!&#39;)&lt;/script&gt;&lt;a href=\&quot;http://ruby-lang-org\&quot; target=\&quot;_blank\&quot; data-malicious=\&quot;inject\&quot;&gt;Ruby&lt;/a&gt;&quot;
      result = &quot;&lt;a class=\&quot;big\&quot; href=\&quot;http://www.rubyonrails.com?id=1&amp;amp;num=2alert(&#39;malicious!&#39;)\&quot;&gt;http://www.rubyonrails.com?id=1&amp;amp;num=2alert(&#39;malicious!&#39;)&lt;/a&gt;&lt;a href=\&quot;http://ruby-lang-org\&quot; target=\&quot;_blank\&quot;&gt;Ruby&lt;/a&gt;&quot;

      options = {
        html: { class: &quot;big&quot; },
        sanitize_options: { attributes: %w[target href] }
      }

      expect(helper.auto_link(text, options)).to eq(result)
      expect(helper.auto_link(text, options)).to be_html_safe
    end

    it &quot;doesn&#39;t sanitize input when sanitize option is false&quot; do
      text = &quot;http://www.rubyonrails.com?id=1&amp;num=2&lt;script&gt;alert(&#39;malicious!&#39;)&lt;/script&gt;&quot;
      result = &quot;&lt;a href=\&quot;http://www.rubyonrails.com?id=1&amp;num=2\&quot;&gt;http://www.rubyonrails.com?id=1&amp;num=2&lt;/a&gt;&lt;script&gt;alert(&#39;malicious!&#39;)&lt;/script&gt;&quot;

      expect(helper.auto_link(text, sanitize: false)).to eq(result)
      expect(helper.auto_link(text, sanitize: false)).not_to be_html_safe
    end

    it &quot;auto links other protocols&quot; do
      [
        &quot;ftp://example.com/file.txt&quot;,
        &quot;https://example.com/file.txt&quot;
      ].each do |input|
        expect(helper.auto_link(input)).to eq(&quot;&lt;a href=\&quot;#{input}\&quot;&gt;#{input}&lt;/a&gt;&quot;)
      end
    end

    it &quot;doesn&#39;t auto link already linked urls&quot; do
      [
        &quot;&lt;a href=\&quot;http://www.rubyonrails.com\&quot;&gt;Ruby on Rails&lt;/a&gt;&quot;,
        &quot;&lt;a href=\&quot;http://www.example.com\&quot;&gt;www.example.com&lt;/a&gt;&quot;,
        &quot;&lt;a href=\&quot;http://www.example.com\&quot;&gt;&lt;b&gt;www.example.com&lt;/b&gt;&lt;/a&gt;&quot;,
        &quot;&lt;a href=\&quot;#close\&quot;&gt;close&lt;/a&gt; &lt;a href=\&quot;http://www.example.com\&quot;&gt;&lt;b&gt;www.example.com&lt;/b&gt;&lt;/a&gt;&quot;
      ].each do |input|
        expect(helper.auto_link(input)).to eq(input)
      end
    end

    it &quot;doesn&#39;t auto link already linked urls when sanitize is false&quot; do
      text = &quot;&lt;a href=\&quot;http://www.example.com\&quot; rel=\&quot;nofollow\&quot;&gt;www.example.com&lt;/a&gt;&quot;
      result = &quot;&lt;a href=\&quot;http://www.example.com\&quot; rel=\&quot;nofollow\&quot;&gt;www.example.com&lt;/a&gt;&quot;

      expect(helper.auto_link(text, sanitize: false)).to eq(result)
    end

    it &quot;doesn&#39;t auto link already linked urls when using sanitize_options&quot; do
      text = &quot;&lt;a href=\&quot;#close\&quot;&gt;close&lt;/a&gt; &lt;a href=\&quot;http://www.example.com\&quot; target=\&quot;_blank\&quot; data-ruby=\&quot;ror\&quot;&gt;&lt;b&gt;www.example.com&lt;/b&gt;&lt;/a&gt;&quot;
      result = &quot;&lt;a href=\&quot;#close\&quot;&gt;close&lt;/a&gt; &lt;a href=\&quot;http://www.example.com\&quot; target=\&quot;_blank\&quot; data-ruby=\&quot;ror\&quot;&gt;&lt;b&gt;www.example.com&lt;/b&gt;&lt;/a&gt;&quot;

      expect(helper.auto_link(text, sanitize_options: { attributes: %w[href target data-ruby] })).to eq(result)
    end

    it &quot;doesn&#39;t auto link already linked mailto: urls&quot; do
      text = &quot;&lt;a href=\&quot;mailto:david@loudthinking.com\&quot;&gt;Mail me&lt;/a&gt;&quot;
      result = &quot;&lt;a href=\&quot;mailto:david@loudthinking.com\&quot;&gt;Mail me&lt;/a&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;handles malicious attributes&quot; do
      text = &quot;&lt;p&gt;http://api.rubyonrails.com/Foo.html\&quot;onmousemove=\&quot;prompt()&lt;/p&gt;&quot;
      result = &quot;&lt;p&gt;&lt;a href=\&quot;http://api.rubyonrails.com/Foo.html\&quot;&gt;http://api.rubyonrails.com/Foo.html&lt;/a&gt;\&quot;onmousemove=\&quot;prompt()&lt;/p&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;auto links urls at the end of the line&quot; do
      text = &quot;&lt;p&gt;http://api.rubyonrails.com/Foo.html&lt;br&gt;http://www.ruby-doc.org/core/Bar.html&lt;br&gt;&lt;/p&gt;&quot;
      result = &quot;&lt;p&gt;&lt;a href=\&quot;http://api.rubyonrails.com/Foo.html\&quot;&gt;http://api.rubyonrails.com/Foo.html&lt;/a&gt;&lt;br&gt;&lt;a href=\&quot;http://www.ruby-doc.org/core/Bar.html\&quot;&gt;http://www.ruby-doc.org/core/Bar.html&lt;/a&gt;&lt;br&gt;&lt;/p&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;is marked as HTML safe&quot; do
      [
        nil,
        &quot;&quot;,
        &quot;hello santiago@wyeworks.com&quot;,
        &quot;hello santiago@wyeworks.com &lt;script&gt;alert(&#39;malicious!&#39;)&lt;/script&gt;&quot;,
        &quot;hello http://www.rubyonrails.org&quot;
      ].each do |input|
        expect(helper.auto_link(input)).to be_html_safe
      end
    end

    it &quot;is not marked as HTML safe when sanitize is false&quot; do
      [
        &quot;hello&quot;,
        &quot;hello santiago@wyeworks.com&quot;,
        &quot;hello http://www.rubyonrails.org&quot;
      ].each do |input|
        expect(helper.auto_link(input, sanitize: false)).not_to be_html_safe
      end
    end

    it &quot;auto links email addresses&quot; do
      text = &quot;aaron@tenderlovemaking.com&quot;
      result = &quot;&lt;a href=\&quot;mailto:aaron@tenderlovemaking.com\&quot;&gt;aaron@tenderlovemaking.com&lt;/a&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;auto links email addresses with special chars&quot; do
      text = &quot;andre$la*+r-a.o&#39;rea=l~ly@tenderlovemaking.com&quot;
      result = &quot;&lt;a href=\&quot;mailto:andre%24la%2A%2Br-a.o%27rea%3Dl%7Ely@tenderlovemaking.com\&quot;&gt;andre$la*+r-a.o&amp;#39;rea=l~ly@tenderlovemaking.com&lt;/a&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;parses urls correctly&quot; do
      urls = %w(
        http://www.rubyonrails.com
        http://www.rubyonrails.com:80
        http://www.rubyonrails.com/~minam
        https://www.rubyonrails.com/~minam
        http://www.rubyonrails.com/~minam/url%20with%20spaces
        http://www.rubyonrails.com/foo.cgi?something=here
        http://www.rubyonrails.com/foo.cgi?something=here&amp;and=here
        http://www.rubyonrails.com/contact;new
        http://www.rubyonrails.com/contact;new%20with%20spaces
        http://www.rubyonrails.com/contact;new?with=query&amp;string=params
        http://www.rubyonrails.com/~minam/contact;new?with=query&amp;string=params
        http://en.wikipedia.org/wiki/Wikipedia:Today%27s_featured_picture_%28animation%29/January_20%2C_2007
        http://www.mail-archive.com/rails@lists.rubyonrails.org/
        http://www.amazon.com/Testing-Equal-Sign-In-Path/ref=pd_bbs_sr_1?ie=UTF8&amp;s=books&amp;qid=1198861734&amp;sr=8-1
        http://en.wikipedia.org/wiki/Texas_hold%39em
        https://www.google.com/doku.php?id=gps:resource:scs:start
        http://connect.oraclecorp.com/search?search[q]=green+france&amp;search[type]=Group
        http://of.openfoundry.org/projects/492/download#4th.Release.3
        http://maps.google.co.uk/maps?f=q&amp;q=the+london+eye&amp;ie=UTF8&amp;ll=51.503373,-0.11939&amp;spn=0.007052,0.012767&amp;z=16&amp;iwloc=A
        http://около.кола/колокола
      )

      urls.each do |url|
        expect(helper.auto_link(url)).to eq(&quot;&lt;a href=\&quot;#{CGI.escapeHTML(url)}\&quot;&gt;#{CGI.escapeHTML(url)}&lt;/a&gt;&quot;)
      end
    end

    it &quot;handles trailing equals on links&quot; do
      text = &quot;http://www.rubyonrails.com/foo.cgi?trailing_equals=&quot;
      result = &quot;&lt;a href=\&quot;http://www.rubyonrails.com/foo.cgi?trailing_equals=\&quot;&gt;http://www.rubyonrails.com/foo.cgi?trailing_equals=&lt;/a&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;handles trailing ampersands on links&quot; do
      text = &quot;http://www.rubyonrails.com/foo.cgi?trailing_ampersand=value&amp;&quot;
      result = &quot;&lt;a href=\&quot;http://www.rubyonrails.com/foo.cgi?trailing_ampersand=value&amp;amp;\&quot;&gt;http://www.rubyonrails.com/foo.cgi?trailing_ampersand=value&amp;amp;&lt;/a&gt;&quot;

      expect(helper.auto_link(text)).to eq(result)
    end

    it &quot;doesn&#39;t timeout when parsing odd email input&quot; do
      inputs = %W(
        foo@...................................
        foo@........................................
        foo@.............................................

        #{&quot;foo&quot; * 20000}@
      )

      inputs.each do |input|
        Timeout.timeout(0.2) do
          expect(helper.auto_link(input)).to eq(input)
        end
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src='../../assets/javascripts/jquery.min.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/prettify.js'></script>
    <script src='../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
    <script src='../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
