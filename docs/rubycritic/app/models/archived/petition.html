<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../overview.html"><img src="../../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2018-08-10 15:58:31 +0100'>2018-08-10 15:58:31 +0100</time>
        
      </span>
    </div>
    <div>
      <h3><small>app/models/archived /</small> petition.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">393</span><small> lines of codes</small></div>
              <div><span class="metric">62</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">4.5</span><small> complexity/method</small></div>
              <div><span class="metric">23</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">276.4</span><small> complexity</small></div>
              <div><span class="metric">83</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                22
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;textacular/searchable&#39;
require_dependency &#39;archived&#39;

module Archived
  class Petition &lt; ActiveRecord::Base<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Archived::Petition assumes too much for instance variable '@_signatures_by_constituency'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Archived::Petition assumes too much for instance variable '@_signatures_by_country'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Irresponsible-Module.md" target="_blank"><b>IrresponsibleModule</b></a>        </span>      </div>      <span>Archived::Petition has no descriptive comment</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Constants.md" target="_blank"><b>TooManyConstants</b></a>        </span>      </div>      <span>Archived::Petition has 9 constants</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Methods.md" target="_blank"><b>TooManyMethods</b></a>        </span>      </div>      <span>Archived::Petition has at least 62 methods</span>          </div>  </li></ol>
    STOPPED_STATE = &#39;stopped&#39;
    CLOSED_STATE = &#39;closed&#39;
    HIDDEN_STATE = &#39;hidden&#39;
    REJECTED_STATE = &#39;rejected&#39;
    STATES = [STOPPED_STATE, CLOSED_STATE, HIDDEN_STATE, REJECTED_STATE]
    PUBLISHED_STATES = [CLOSED_STATE]
    VISIBLE_STATES = [CLOSED_STATE, REJECTED_STATE]
    MODERATED_STATES = [CLOSED_STATE, HIDDEN_STATE, REJECTED_STATE]
    DEBATABLE_STATES = [CLOSED_STATE]

    belongs_to :parliament, inverse_of: :petitions, required: true
    belongs_to :locked_by, class_name: &#39;AdminUser&#39;

    has_one :creator, -&gt; { creator }, class_name: &quot;Signature&quot;
    has_one :debate_outcome, dependent: :destroy
    has_one :government_response, dependent: :destroy
    has_one :note, dependent: :destroy
    has_one :rejection, dependent: :destroy

    has_many :emails, :dependent =&gt; :destroy
    has_many :signatures
    has_many :sponsors, -&gt; { sponsors }, class_name: &quot;Signature&quot;

    validates :action, presence: true, length: { maximum: 150 }
    validates :background, length: { maximum: 300 }, allow_blank: true
    validates :additional_details, length: { maximum: 1000 }, allow_blank: true
    validates :state, presence: true, inclusion: STATES
    validates :closed_at, presence: true, if: :closed?

    before_save :update_debate_state, if: :scheduled_debate_date_changed?

    extend Searchable(:action, :background, :additional_details)
    include Browseable, Taggable

    filter :parliament

    facet :all, -&gt; { visible.by_most_signatures }
    facet :awaiting_response, -&gt; { awaiting_response.by_waiting_for_response_longest }
    facet :awaiting_debate_date, -&gt; { awaiting_debate_date.by_waiting_for_debate_longest }
    facet :with_debate_outcome, -&gt; { with_debate_outcome.by_most_recent_debate_outcome }
    facet :with_debated_outcome, -&gt; { with_debated_outcome.by_most_recent_debate_outcome }
    facet :published, -&gt; { published.by_most_signatures }
    facet :stopped, -&gt; { stopped.by_most_signatures }
    facet :closed, -&gt; { closed.by_most_signatures }
    facet :rejected, -&gt; { rejected.by_most_signatures }
    facet :hidden, -&gt; { hidden.by_most_recent }
    facet :with_response, -&gt; { with_response.by_most_signatures }
    facet :debated, -&gt; { debated.by_most_recent_debate_outcome }
    facet :not_debated, -&gt; { not_debated.by_most_recent_debate_outcome }
    facet :by_most_signatures, -&gt; { by_most_signatures }
    facet :by_created_at, -&gt; { by_created_at }
    facet :in_debate_queue, -&gt; { in_debate_queue.by_waiting_for_debate_longest }

    default_scope { preload(:parliament) }

    delegate :threshold_for_response, :threshold_for_debate, to: :parliament
    delegate :show_on_a_map?, to: :parliament

    with_options allow_nil: true, prefix: true do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="petition.html#L64" class="js-smell-location">0</a>                  <a href="../petition.html#L97" class="js-smell-location">1</a>                  </div>  </li></ol>
      delegate :name, :email, to: :creator
      delegate :code, :details, to: :rejection
      delegate :summary, :details, :created_at, :updated_at, to: :government_response
      delegate :date, :transcript_url, :video_url, :overview, to: :debate_outcome, prefix: :debate
      delegate :debate_pack_url, to: :debate_outcome, prefix: false
    end

    alias_attribute :open_at, :opened_at

    class &lt;&lt; self
      def for_state(state)
        where(state: state)
      end

      def by_created_at
        reorder(created_at: :asc)
      end

      def by_most_recent_debate_outcome
        reorder(debate_outcome_at: :desc, created_at: :desc)
      end

      def by_waiting_for_debate_longest
        reorder(debate_threshold_reached_at: :asc, created_at: :desc)
      end

      def by_most_recent
        reorder(created_at: :desc)
      end

      def by_most_signatures
        reorder(signature_count: :desc)
      end

      def by_waiting_for_response_longest
        reorder(response_threshold_reached_at: :asc, created_at: :desc)
      end

      def awaiting_debate_date
        debate_threshold_reached.not_scheduled
      end

      def awaiting_response
        response_threshold_reached.not_responded
      end

      def not_responded
        where(government_response_at: nil)
      end

      def with_response
        where.not(government_response_at: nil).preload(:government_response)
      end

      def response_threshold_reached
        where.not(response_threshold_reached_at: nil)
      end

      def published
        where(state: PUBLISHED_STATES)
      end

      def moderated
        where(state: MODERATED_STATES)
      end

      def stopped
        where(state: STOPPED_STATE)
      end

      def closed
        where(state: CLOSED_STATE)
      end

      def rejected
        where(state: REJECTED_STATE)
      end

      def hidden
        where(state: HIDDEN_STATE)
      end

      def debateable
        where(state: DEBATABLE_STATES)
      end

      def debated
        where(debate_state: &#39;debated&#39;).preload(:debate_outcome)
      end

      def not_debated
        where(debate_state: &#39;not_debated&#39;)
      end

      def debate_threshold_reached
        where.not(debate_threshold_reached_at: nil)
      end

      def debate_scheduled
        where.not(scheduled_debate_date: nil)
      end

      def not_scheduled
        where(scheduled_debate_date: nil)
      end

      def with_debate_outcome
        where.not(debate_outcome_at: nil)
      end

      def with_debated_outcome
        debated.where.not(debate_outcome_at: nil)
      end

      def visible
        where(state: VISIBLE_STATES)
      end

      def in_need_of_marking_as_debated(date = Date.current)
        where(scheduled_debate_state.and(debate_date_in_the_past(date)))
      end

      def mark_petitions_as_debated!(date = Date.current)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Missing-Safe-Method.md" target="_blank"><b>MissingSafeMethod</b></a>        </span>      </div>      <span>Archived::Petition has missing safe method 'mark_petitions_as_debated!'</span>          </div>  </li></ol>
        in_need_of_marking_as_debated(date).update_all(debate_state: &#39;debated&#39;)
      end

      def in_debate_queue
        where(threshold_for_debate_reached.or(scheduled_for_debate))
      end

      private

      def debate_date_in_the_past(date)
        arel_table[:scheduled_debate_date].lt(date)
      end

      def scheduled_debate_state
        arel_table[:debate_state].eq(&#39;scheduled&#39;)
      end

      def threshold_for_debate_reached
        arel_table[:debate_threshold_reached_at].not_eq(nil)
      end

      def scheduled_for_debate
        arel_table[:scheduled_debate_date].not_eq(nil)
      end
    end

    def moderated?
      state.in?(MODERATED_STATES)
    end

    def can_have_debate_added?
      state.in?(DEBATABLE_STATES)
    end

    def stopped?
      state == STOPPED_STATE
    end

    def closed?
      state == CLOSED_STATE
    end

    def rejected?
      state == REJECTED_STATE
    end

    def hidden?
      state == HIDDEN_STATE
    end

    def published?
      state.in?(PUBLISHED_STATES)
    end

    def duration
      if parliament.petition_duration?
        parliament.petition_duration
      elsif opened_at?
        calculate_petition_duration
      else
        0
      end
    end

    def closed_early_due_to_election?
      closed_at == parliament.dissolution_at
    end

    def government_response?
      government_response_at &amp;&amp; government_response
    end

    def threshold_for_debate_reached?
      signature_count &gt;= parliament.threshold_for_debate
    end

    def threshold_for_response_reached?
      signature_count &gt;= parliament.threshold_for_response
    end

    def signatures_by_constituency
      if defined?(@_signatures_by_constituency)
        @_signatures_by_constituency
      else
        if signatures_by_constituency?
          @_signatures_by_constituency = calculate_signatures_by_constituency(super)
        else
          []
        end
      end
    end

    def signatures_by_country
      if defined?(@_signatures_by_country)
        @_signatures_by_country
      else
        if signatures_by_country?
          @_signatures_by_country = calculate_signatures_by_country(super)
        else
          []
        end
      end
    end

    def get_email_requested_at_for(name)
      self[&quot;email_requested_for_#{name}_at&quot;]
    end

    def set_email_requested_at_for(name, to: Time.current)
      update_column(&quot;email_requested_for_#{name}_at&quot;, to)
    end

    def signatures_to_email_for(name)
      if timestamp = get_email_requested_at_for(name)
        signatures.need_emailing_for(name, since: timestamp)
      else
        raise ArgumentError, &quot;The #{name} email has not been requested for petition #{id}&quot;
      end
    end

    def update_debate_state
      self.debate_state = evaluate_debate_state
    end

    def update_lock!(user, now = Time.current)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Archived::Petition takes parameters ['now', 'user'] to 3 methods</span>              <span>Locations:</span>                  <a href="petition.html#L312" class="js-smell-location">0</a>                  <a href="petition.html#L318" class="js-smell-location">1</a>                  <a href="petition.html#L328" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Missing-Safe-Method.md" target="_blank"><b>MissingSafeMethod</b></a>        </span>      </div>      <span>Archived::Petition has missing safe method 'update_lock!'</span>          </div>  </li></ol>
      if locked_by == user<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Archived::Petition#update_lock! is controlled by argument 'user'</span>          </div>  </li></ol>
        update!(locked_at: now)
      end
    end

    def checkout!(user, now = Time.current)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="petition.html#L318" class="js-smell-location">0</a>                  <a href="../petition.html#L750" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Archived::Petition takes parameters ['now', 'user'] to 3 methods</span>              <span>Locations:</span>                  <a href="petition.html#L312" class="js-smell-location">0</a>                  <a href="petition.html#L318" class="js-smell-location">1</a>                  <a href="petition.html#L328" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Missing-Safe-Method.md" target="_blank"><b>MissingSafeMethod</b></a>        </span>      </div>      <span>Archived::Petition has missing safe method 'checkout!'</span>          </div>  </li></ol>
      with_lock do
        if locked_by.present? &amp;&amp; locked_by != user
          false
        else
          update!(locked_by: user, locked_at: now)
        end
      end
    end

    def force_checkout!(user, now = Time.current)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Data-Clump.md" target="_blank"><b>DataClump</b></a>        </span>      </div>      <span>Archived::Petition takes parameters ['now', 'user'] to 3 methods</span>              <span>Locations:</span>                  <a href="petition.html#L312" class="js-smell-location">0</a>                  <a href="petition.html#L318" class="js-smell-location">1</a>                  <a href="petition.html#L328" class="js-smell-location">2</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Missing-Safe-Method.md" target="_blank"><b>MissingSafeMethod</b></a>        </span>      </div>      <span>Archived::Petition has missing safe method 'force_checkout!'</span>          </div>  </li></ol>
      update!(locked_by: user, locked_at: now)
    end

    def release!(user)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="petition.html#L332" class="js-smell-location">0</a>                  <a href="../petition.html#L764" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Missing-Safe-Method.md" target="_blank"><b>MissingSafeMethod</b></a>        </span>      </div>      <span>Archived::Petition has missing safe method 'release!'</span>          </div>  </li></ol>
      with_lock do
        if locked_by.present? &amp;&amp; locked_by == user<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Control-Parameter.md" target="_blank"><b>ControlParameter</b></a>        </span>      </div>      <span>Archived::Petition#release! is controlled by argument 'user'</span>          </div>  </li></ol>
          update!(locked_by: nil, locked_at: nil)
        end
      end
    end

    private

    def evaluate_debate_state
      if scheduled_debate_date?
        scheduled_debate_date &gt; Date.current ? &#39;scheduled&#39; : &#39;debated&#39;
      else
        &#39;awaiting&#39;
      end
    end

    def calculate_petition_duration<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Archived::Petition#calculate_petition_duration has a flog score of 46</span>          </div>  </li></ol>
      if opened_at + 3.months == closed_at
        3
      elsif opened_at + 6.months == closed_at
        6
      elsif opened_at + 9.months == closed_at
        9
      elsif opened_at + 12.months == closed_at
        12
      else
        Rational(closed_at - opened_at, 86400 * 30).to_f
      end
    end

    def constituencies(external_ids)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Archived::Petition#constituencies doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      Constituency.where(external_id: external_ids).order(:name)
    end

    def calculate_signatures_by_constituency(hash)
      constituencies(hash.keys).map do |constituency|
        {
          name: constituency.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_constituency refers to 'constituency' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L371" class="js-smell-location">0</a>                  <a href="petition.html#L372" class="js-smell-location">1</a>                  <a href="petition.html#L373" class="js-smell-location">2</a>                  <a href="petition.html#L374" class="js-smell-location">3</a>                  </div>  </li></ol>
          ons_code: constituency.ons_code,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_constituency refers to 'constituency' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L371" class="js-smell-location">0</a>                  <a href="petition.html#L372" class="js-smell-location">1</a>                  <a href="petition.html#L373" class="js-smell-location">2</a>                  <a href="petition.html#L374" class="js-smell-location">3</a>                  </div>  </li></ol>
          mp: constituency.mp_name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_constituency refers to 'constituency' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L371" class="js-smell-location">0</a>                  <a href="petition.html#L372" class="js-smell-location">1</a>                  <a href="petition.html#L373" class="js-smell-location">2</a>                  <a href="petition.html#L374" class="js-smell-location">3</a>                  </div>  </li></ol>
          signature_count: hash[constituency.external_id]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_constituency refers to 'constituency' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L371" class="js-smell-location">0</a>                  <a href="petition.html#L372" class="js-smell-location">1</a>                  <a href="petition.html#L373" class="js-smell-location">2</a>                  <a href="petition.html#L374" class="js-smell-location">3</a>                  </div>  </li></ol>
        }
      end
    end

    def locations(codes)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>Archived::Petition#locations doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
      Location.where(code: codes).order(:name)
    end

    def calculate_signatures_by_country(hash)
      locations(hash.keys).map do |location|
        {
          name: location.name,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_country refers to 'location' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L386" class="js-smell-location">0</a>                  <a href="petition.html#L387" class="js-smell-location">1</a>                  <a href="petition.html#L388" class="js-smell-location">2</a>                  </div>  </li></ol>
          code: location.code,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_country calls 'location.code' 2 times</span>              <span>Locations:</span>                  <a href="petition.html#L387" class="js-smell-location">0</a>                  <a href="petition.html#L388" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_country refers to 'location' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L386" class="js-smell-location">0</a>                  <a href="petition.html#L387" class="js-smell-location">1</a>                  <a href="petition.html#L388" class="js-smell-location">2</a>                  </div>  </li></ol>
          signature_count: hash[location.code]<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_country calls 'location.code' 2 times</span>              <span>Locations:</span>                  <a href="petition.html#L387" class="js-smell-location">0</a>                  <a href="petition.html#L388" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Feature-Envy.md" target="_blank"><b>FeatureEnvy</b></a>        </span>      </div>      <span>Archived::Petition#calculate_signatures_by_country refers to 'location' more than self (maybe move it to another class?)</span>              <span>Locations:</span>                  <a href="petition.html#L386" class="js-smell-location">0</a>                  <a href="petition.html#L387" class="js-smell-location">1</a>                  <a href="petition.html#L388" class="js-smell-location">2</a>                  </div>  </li></ol>
        }
      end
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src='../../../assets/javascripts/jquery.min.js'></script>
    <script src='../../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../../assets/javascripts/prettify.js'></script>
    <script src='../../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../../assets/javascripts/application.js'></script>
    <script src='../../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
